<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Canal de Denúncias</title>
</head>
<body>
  <h2>Canal de Denúncias Anônimo</h2>

  <button onclick="criarChat()">Criar novo chat</button>
  <br><br>
  <input type="text" id="codigoChat" placeholder="Código do chat existente">
  <input type="text" id="senha" placeholder="Senha de acesso">
  <button onclick="entrarChat()">Entrar</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDDjD6VMIRxgDq13yXjMYeYI2b7-QqqdVI",
      authDomain: "canal-denuncias-poli26.firebaseapp.com",
      databaseURL: "https://canal-denuncias-poli26-default-rtdb.firebaseio.com",
      projectId: "canal-denuncias-poli26",
      storageBucket: "canal-denuncias-poli26.firebasestorage.app",
      messagingSenderId: "102848286523",
      appId: "1:102848286523:web:4b539fe5ec3e15d7e3311e"
    };

// Initialize Firebase
const app = initializeApp(firebaseConfig);

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function gerarSenha() {
      return Math.random().toString(36).slice(-6);
    }

    // ✅ Esta função precisa estar no window
    window.criarChat = async function () {
      const codigo = Date.now().toString();
      const senhaDenunciante = gerarSenha();
      const senhaComissao = gerarSenha();

      const refChat = ref(db, "chats/" + codigo);
      await set(refChat, {
        senhaDenunciante,
        senhaComissao,
        mensagens: []
      });

      alert(`Chat criado com sucesso!\n\nCódigo do chat: ${codigo}\n\nSenha do denunciante: ${senhaDenunciante}\nSenha da comissão: ${senhaComissao}`);
    };

    window.entrarChat = function () {
      const codigo = document.getElementById('codigoChat').value.trim();
      const senha = document.getElementById('senha').value.trim();

      if (codigo && senha) {
        sessionStorage.setItem('codigoChat', codigo);
        sessionStorage.setItem('senha', senha);
        window.location.href = 'chat.html';
      } else {
        alert("Preencha o código do chat e a senha.");
      }
    };
  </script>
</body>
</html>
