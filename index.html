<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Canal de Denúncias</title>
</head>
<body>
  <h2>Canal de Denúncias Anônimo</h2>

  <button id="btnCriar">Criar novo chat</button>
  <br><br>

  <input type="text" id="codigoChat" placeholder="Código do chat existente" />
  <input type="text" id="senha" placeholder="Senha de acesso" />
  <button id="btnEntrar">Entrar</button>

  <script type="module">
    import { db } from "./firebase-config.js";
    import { ref, set } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    function gerarSenha() {
      return Math.random().toString(36).slice(-6);
    }

    async function criarChat() {
      const codigo = Date.now().toString();
      const senhaDenunciante = gerarSenha();
      const senhaComissao = gerarSenha();

      const refChat = ref(db, "chats/" + codigo);
      await set(refChat, {
        senhaDenunciante,
        senhaComissao,
        mensagens: []
      });

      alert(
        `Chat criado com sucesso!\n\nCódigo do chat: ${codigo}\n\nSenha do denunciante: ${senhaDenunciante}\nSenha da comissão: ${senhaComissao}`
      );
    }

    function entrarChat() {
      const codigo = document.getElementById("codigoChat").value.trim();
      const senha = document.getElementById("senha").value.trim();

      if (codigo && senha) {
        sessionStorage.setItem("codigoChat", codigo);
        sessionStorage.setItem("senha", senha);
        window.location.href = "chat.html";
      } else {
        alert("Preencha o código do chat e a senha.");
      }
    }

    // ✅ associa os botões corretamente
    document.getElementById("btnCriar").addEventListener("click", criarChat);
    document.getElementById("btnEntrar").addEventListener("click", entrarChat);
  </script>
</body>
</html>
